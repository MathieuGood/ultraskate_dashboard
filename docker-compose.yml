version: '3.8'

services:
  backend:
    build:
      context: ./backend # Docker will look for backend code here
      dockerfile: ../Dockerfile.backend # Path to the backend Dockerfile
    ports:
      - "8000:8000" # Map host port 8000 to container port 8000
    volumes:
      - ./backend:/app/backend # Mount the local backend code into the container for hot-reloading
    environment:
      PYTHONUNBUFFERED: 1 # Ensure Python output is not buffered

  frontend:
    build:
      context: ./frontend # Docker will look for frontend code here
      dockerfile: ../Dockerfile.frontend # Path to the frontend Dockerfile
    ports:
      - "5173:5173" # Map host port 5173 to container port 5173 (Vite's default)
    volumes:
      - ./frontend:/app/frontend # Mount the local frontend code into the container for hot-reloading
      - /app/frontend/node_modules # Exclude node_modules from the host mount to prevent issues
    command: ["npm", "run", "dev", "--", "--host", "0.0.0.0"] # Explicitly set Vite to listen on all interfaces
    depends_on:
      - backend # Ensures the backend service starts before the frontend service
